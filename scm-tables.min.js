!function(a){a.fn.addTable=function(b){var c={id:"scm-table",classes:"",css:{},sortable:!1,editable:!1,autocomplete:!1,head:0,header:[],columns:3,rows:3,prepend:!1,emptyrow:!1},d=a.extend(c,b),e=this;$table=a('<table class="scm-table"></table>').attr("id",d.id).addClass(d.classes).css(d.css),d.prepend?e.prepend($table):e.append($table);var f=[],g=function(){for(var b=a("<thead></thead>").appendTo($table),c=d.header,e=d.head?d.head:c.length,g=0;g<e;g++){var h=g==e-1?'class="row-head" ':"",i=a("<tr "+h+'data-table-row="'+g+'"></tr>').appendTo(b),j=0;c[g]&&a.each(c[g],function(b,c){var e=a.isNumeric(b)?"":b;if(h){var k=c.name,l=!!c.icon&&c.icon.startsWith("fa-"),m=c.icon?'<i class="fa '+(l?c.icon:"text")+'">'+(l?"":c.icon)+"</i> ":"",n=c.format?c.format:"string",o=c.exception?c.exception:"",p=c.decimal?c.decimal:0,q=d.autocomplete&&!c.noauto&&"date"!=n,r=c.sort?c.sort:"",s=!!c.nosort||!d.sortable,t=!!c.noedit||!d.editable;e=(c.icon?" pin":"")+(c.color?" "+c.color:"")+(s?" no-sort":" sort")+(t?" no-edit":" edit"),f[j]={slug:b,format:n,exception:o,decimal:p,noedit:t,auto:q},i.append('<th class="'+e+'" data-auto-complete="'+q+'" data-column-name="'+b+'" data-column-format="'+n+'" data-column-exception="'+o+'" data-column-decimal="'+p+'" data-column-sort="'+!s+'" data-column-sortby="'+r+'" data-column-edit="'+!t+'" data-cell="'+(g+1)*j+'" data-cell-row="'+g+'" data-cell-column="'+j+'" >'+m+k+"</th>")}else i.append("<th"(e?' class="'+e+'"':"")+' data-column-name="'+b+' data-cell="'+(g+1)*j+'" data-cell-row="'+g+'" data-cell-column="'+j+'" >'+c+"</th>");j++})}},h=function(){for(var b=a("<tbody></tbody>").appendTo($table),c=0;c<d.rows+(d.emptyrow?1:0);c++)for(var e=a("<tr "+(d.emptyrow&&c==d.rows?' class="empty"':"")+'data-table-row="'+c+'"></tr>').appendTo(b),g=0;g<d.columns;g++){var h=f[g];e.append('<td class="cell'+(h.slug?" "+h.slug:"")+(h.noedit?" no-edit":"")+'" data-column-name="'+h.slug+'" data-cell="'+(c+1)*g+'" data-cell-row="'+c+'" data-cell-column="'+g+'" data-cell-format="'+(h.format?h.format:"string")+'" data-cell-exception="'+(h.exception?h.exception:"")+'" data-cell-decimal="'+(h.decimal?h.decimals:0)+'" data-cell-auto="'+(!!h.auto&&h.auto)+'"></th>')}};return d.header.length&&g(),h(),d.sortable&&$table.addClass("sortable").sortTable(),d.editable&&$table.addClass("editable").editTable({editor:a('<input class="editable-input">'),picker:a('<input class="color-picker editable-input">'),calendar:a('<input class="date-picker editable-input">'),offset:{width:0,height:0}}),$table.find("tr > th:first-child, tr > td:first-child").addClass("first"),$table.find("tr > th:last-child, tr > td:last-child").addClass("last"),$table},a.fn.getCell=function(b,c,d){var e=".cell"+(void 0===c||c===!1||a.isNumeric(c)?"":"."+c)+(void 0===b||b===!1||a.isNumeric(b)?"":"."+b),f=(a.isNumeric(c)?'[data-cell-row="'+c+'"]':"")+(a.isNumeric(b)?'[data-cell-column="'+b+'"]':"");return a(a(this).find((d?d:"tbody ")+e+f))},a.fn.pushRow=function(b,c){var d=this.find("tbody"),e=d.find("tr"),f=e.length,g=f-1,h=void 0===b||b<0?g:b,i=a(e[h]).clone().data("table-row",f).appendTo(d),j=i.length;return a(e[h]).removeClass("empty"),a.each(i.find("td"),function(b,d){var e=a(this);e.data("cell",e.data("cell")+j).data("cell-row",f).text(""),void 0!==c&&a.each(c,function(a,b){e.on(a,b)})}),i},a.fn.getRow=function(b,c){return a(a(this).find((c?c:"tbody")+(a.isNumeric(b)?' [data-table-row="'+b+'"]':" tr."+b)))};var b=function(a,b){return a>b?1:a<b?-1:0},c=function(a,b){return a>b?-1:a<b?1:0},d=function(a,c){var d=f(a),e=f(c);return b(d,e)},e=function(a,b){var d=f(a),e=f(b);return c(d,e)},f=function(a){var b=a.split("-");return new Date(b[2],b[1]-1,b[0]).getTime()};a.fn.sortCells=function(f,g){var h=a(this),i=h.parents("tbody"),j="date"==f||"time"==f||"timer"==f,k=!g||"orig"===g||"original"===g,l=h.sort(function(h,i){var l="",m="";if(k)l=a(h).data("cell-row"),m=a(i).data("cell-row");else{if(l=a(h).text(),m=a(i).text(),""===l)return-1;if(""===m)return 1;if(j)return"asc"!=g?e(l,m):d(l,m)}return"int"==f||k?(l=parseInt(l),m=parseInt(m)):"number"!=f&&"float"!=f||(l=parseFloat(l),m=parseFloat(m)),"asc"!=g?c(l,m):b(l,m)});a.each(l,function(b,c){i.find('tr[data-table-row="'+a(c).data("cell-row")+'"]').detach().prependTo(i)})},a.fn.sortColumn=function(b,c){return this.each(function(){var d=a(this),e=b,f=c&&c.length&&c.data("column-format")?c.data("column-format"):e.data("column-format")?e.data("column-format"):"string",g=c&&c.length&&c.data("cell-column")?c.data("cell-column"):e.data("cell-column")?e.data("cell-column"):0,h=a.Event("sort");e.siblings().removeClass("sort-down").removeClass("sort-up");var i=d.find('td[data-cell-column="'+g+'"]');e.hasClass("sort-down")?(e.removeClass("sort-down"),e.addClass("sort-up"),i.sortCells(f,"asc")):e.hasClass("sort-up")?(e.removeClass("sort-up"),i.sortCells(f,"orig")):(e.addClass("sort-down"),i.sortCells(f,"desc")),d.trigger(h)})},a.fn.sortTable=function(){return this.each(function(){var b=a(this),c=b.find('thead tr.row-head th:not( [data-column-sort="false"] )');c.length>0&&c.css("cursor","pointer").on("click",function(c){var d=a(this),e=d.data("column-sortby");e&&(e=b.find('th[data-column-name="'+e+'"]')),b.sortColumn(d,e)})})};var g=function(a,b){var b=b||"mm-dd-yyyy",c=/[^mdy]/.exec(b)[0],d=b.split(c),e=a.split(c),f=function(a,b){for(var c,d,e,f=0,g=b.length;f<g;f++)/m/.test(b[f])&&(c=a[f]),/d/.test(b[f])&&(d=a[f]),/y/.test(b[f])&&(e=a[f]);return c>0&&c<13&&e&&4===e.length&&d>0&&d<=new Date(e,c,0).getDate()};return f(e,d)},h=function(b){var c=(new Date).getFullYear().toString(),d=b.split("-");if(d.length<2)return!1;if(d.length<3){if(d[1].length<2)return!1;d.push(c)}return 3==d.length&&(d[2]||(d[2]=c)),!(d[2].length<4)&&(a.Numeric(d[0])>31&&(d[0]="31"),a.Numeric(d[1])>12&&(d[1]="12"),d[0].length<2&&(d[0]="0"+d[0]),d[1].length<2&&(d[1]="0"+d[1]),d[0].length>2&&(d[0]=d[0].substring(0,2)),d[1].length>2&&(d[1]=d[1].substring(0,2)),d[2].length>4&&(d[2]=d[2].substring(0,4)),b=d[0]+"-"+d[1]+"-"+d[2],!!g(b,"dd-mm-yyyy")&&b)};a.fn.validCell=function(b){if(!b)return this;var c=b instanceof jQuery,d=c?this:0,e=c?d.val():b,f=c?b:this,g=f.data("cell-format")?f.data("cell-format"):"string",i=f.data("cell-exception")?f.data("cell-exception"):"",j=f.data("cell-correct")!==!1,l=(parseInt(f.data("cell-decimal")),a.Event("validate"));switch(g){case"int":case"number":case"float":e=e.replace(i,""),e=a.Numeric(e);break;case"date":e=h(e),j&&e&&d&&d.datepicker("setDate",e)}return f.trigger(l,e),l.result===!1||e===!1?(d&&d.addClass("error"),f.addClass("error")):(d&&d.removeClass("error"),f.removeClass("error")),this},a.fn.editCell=function(b){if(!b&&0!==b)return this;var n,c=b instanceof jQuery,d=c?this:0,e=d?b:this,f=e.data("cell-format")?e.data("cell-format"):"string",g=e.data("cell-exception")?e.data("cell-exception"):"",i=e.data("cell-correct")!==!1,j=e.data("cell-auto")===!0,k=parseInt(e.data("cell-decimal")),l=d?d.val():b.toString(),m=a.Event("change");if(e.text()===l.toString()||!i&&e.hasClass("error"))return d&&d.removeClass("error"),!0;if(i&&(d&&d.removeClass("error"),e.removeClass("error"),j||!j&&""!==l))switch(f){case"int":case"number":case"float":if(n=l,l=l.substring(0,l.indexOf(g)),l=a.Numeric(l),l===!1)return!0;l=parseFloat(l),"int"==f?l=Math.round(l):k&&(l=l.toFixed(k)),l=n;break;case"date":if(l=h(l),!l)return!0}return n=e.html(),e.text(l.toString()).trigger(m,l),m.result===!1&&e.html(n),this},a.fn.editTable=function(b){"use strict";return this.each(function(){var u,v,c=function(){var b=a.extend({},a.fn.editTable.defaults);return b.editor=b.editor.clone(),b},d=a.extend(c(),b),e=37,f=38,g=39,h=40,i=13,j=27,k=9,l=a(this),m=l.parent(),n=d.editor.css("position","absolute").hide().appendTo(m),o=d.picker.css("position","absolute").hide().appendTo(m).iris(),p=d.calendar.css("position","absolute").hide().appendTo(m).datepicker({dateFormat:"dd-mm-yy",constrainInput:!1,onSelect:function(a){u.editCell(a)}}),q=[n,o,p],r=d.offset,s="width"in r?r.width:0,t="height"in r?r.height:0,w=!1,x="",y=function(a,b,c){a&&a.hasClass("active")&&(b&&(void 0!==c?b.editCell(c):a.editCell(b)),a.removeClass("active").hide())},z=function(b){if(u=l.find("td.edit:focus"),u.length){u.removeClass("error"),x=u.data("cell-format");var c=u.data("column-name"),e=l.find('th[data-column-name="'+c+'"]').data("auto-complete");if(v="color"==x?o:"date"==x?p:n,"date"==x?v.datepicker("setDate",u.text()):v.val(u.text()),v.addClass("active").show().offset(u.offset()).css(u.css(d.props)).width(u.width()+s).height(u.height()+t),e){var f=l.find('td[data-column-name="'+c+'"]').not(u),g=[];f.each(function(){a.inArray(a(this).text(),g)==-1&&g.push(a(this).text())}),v.autocomplete({source:g.sort(),appendTo:m,minLength:0,select:function(a,b){b.value&&y(v,u,b.value)}}),a(".ui-autocomplete").css({"min-width":v.outerWidth()}),v.autocomplete("enable"),v.autocomplete("search","")}else v.autocomplete("instance")&&v.autocomplete("disable");v.focus(),b&&v.select();var h=v.getCursorPosition();v.data("caret-start",h.start),v.data("caret-end",h.end)}},A=function(a,b){var c=[];if(b){if(b===g)c=w?a.nextAll("td.edit:last"):a.nextAll("td.edit:first");else if(b===e)c=w?a.prevAll("td.edit:last"):a.prevAll("td.edit:first");else if(b===f)c=w?a.parent().prevAll("tr:last").children().eq(a.index()):a.parent().prev().children().eq(a.index());else if(b===h)c=w?a.parent().nextAll("tr:last").children().eq(a.index()):a.parent().next().children().eq(a.index());else{if(b!==!0)return c;c=a.filter(".edit")}return c.filter(".edit")}return c};a.each(q,function(a,b){b.blur(function(a){y(b,u)}).keydown(function(a){var c=v.getCursorPosition();c.start!==c.end?b.data("caret-sel",1):b.data("caret-sel",0),a.which===i?(y(b,u),u.focus(),a.preventDefault(),a.stopPropagation()):a.which===j?(b.val(u.text()),a.preventDefault(),a.stopPropagation(),y(b),u.focus()):a.which===k&&u.focus()}).keyup(function(a){var c=b.data("caret-start"),d=v.getCursorPosition();if(b.data("caret-start",d.start),b.data("caret-end",d.end),!(b.data("caret-sel")||c!==d.start&&b.val())){var e=A(u,a.which);e.length>0&&(y(b,u),e.focus(),a.preventDefault(),a.stopPropagation())}}).on("input paste",function(){b.validCell(u)})}),l.find("td").prop("tabindex",1).addClass("edit"),l.find(".no-edit").removeClass("edit"),l.on("click keypress dblclick",function(a){z(!0)}).keydown(function(b){93==b.which&&(w=!0);var c=!0,d=A(a(b.target),b.which);d.length>0?d.focus():b.which===i?z(!0):46==b.keyCode||8==b.keyCode?l.find("td.edit:focus").text(""):c=!1,c&&(b.stopPropagation(),b.preventDefault())}).keyup(function(a){93==a.which&&(w=!1)}),a(window).on("resize",function(){a.each(q,function(a,b){b.is(":visible")&&b.offset(u.offset()).width(u.width()+s).height(u.height()+t)})})})},a.fn.editTable.defaults={props:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border-radius","border","border-top","border-bottom","border-left","border-right"],editor:a("<input>"),picker:a('<input class="color-picker">'),calendar:a('<input class="date-picker">'),offset:{width:0,height:0}}}(jQuery);